<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - SkillTrack</title>
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* CustomScrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Animation utilities */
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Preserve JS Toggles */
        .page {
            display: none;
        }

        .page.show {
            display: block;
        }

        /* Active styling for Navigation */
        .nav.active {
            background-color: #4f46e5;
            /* Indigo-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
        }

        .nav:hover:not(.active) {
            background-color: #1e293b;
            /* Slate-800 */
            color: #e2e8f0;
        }

        /* Modal Transitions (handled by JS display toggle, but we add base centering) */
        .modal {
            display: none;
            /* JS sets display: flex on open, so we trust that. 
               However, to ensure flex centering works when JS sets 'display: block', 
               we might need to force flex if standard JS just uses show/hide toggles. 
               Based on login.js, it sets 'flex'. student.js uses classList.add('show'). */
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex !important;
        }

        /* Center contents */

        /* Custom Status Colors for dynamic content if needed, though Tailwind classes preferred */
        /* Star Celebration Animation */
        .celebration-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .star {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: gold;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: fall linear forwards;
            opacity: 0;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg) scale(0);
                opacity: 1;
            }

            10% {
                transform: translateY(0) rotate(45deg) scale(1);
            }

            100% {
                transform: translateY(110vh) rotate(720deg) scale(0.5);
                opacity: 0;
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-[#172554] h-screen overflow-hidden flex">

    <!-- SIDEBAR -->
    <aside
        class="sidebar w-64 bg-[#172554] border-r border-[#1e40af] flex-shrink-0 flex flex-col h-full transition-all duration-300 fixed md:relative z-20 hidden md:flex">
        <div class="p-6 border-b border-[#1e40af]">
            <h2 class="text-2xl font-bold text-white tracking-tight flex items-center gap-2">
                <img src="analogica_logo.jpg" alt="Logo" class="w-8 h-8 rounded-full object-contain"> SkillTrack
            </h2>
            <p class="text-slate-500 text-xs mt-1 font-medium tracking-wider uppercase">Student Portal</p>
        </div>

        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <div class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 ml-2">Menu</div>

            <a class="nav active flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 font-medium transition-all cursor-pointer group"
                data-page="dashboard">
                <i class="fa-solid fa-chart-line w-5 text-center transition-transform group-hover:scale-110"></i>
                <span>Dashboard</span>
            </a>
            <a class="nav flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 font-medium transition-all cursor-pointer group"
                data-page="courses">
                <i class="fa-solid fa-book w-5 text-center transition-transform group-hover:scale-110"></i>
                <span>Courses</span>
            </a>
            <a class="nav flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 font-medium transition-all cursor-pointer group"
                data-page="assignments">
                <i class="fa-solid fa-list-check w-5 text-center transition-transform group-hover:scale-110"></i>
                <span>Assignments</span>
            </a>
            <a class="nav flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 font-medium transition-all cursor-pointer group"
                data-page="quizzes">
                <i class="fa-solid fa-brain w-5 text-center transition-transform group-hover:scale-110"></i>
                <span>Quizzes</span>
            </a>
            <a class="nav flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 font-medium transition-all cursor-pointer group"
                data-page="mentors">
                <i class="fa-solid fa-user-group w-5 text-center transition-transform group-hover:scale-110"></i>
                <span>Mentors</span>
            </a>
            <a class="nav flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 font-medium transition-all cursor-pointer group"
                data-page="progress">
                <i class="fa-solid fa-chart-pie w-5 text-center transition-transform group-hover:scale-110"></i>
                <span>Progress</span>
            </a>
        </nav>

        <div class="p-4 border-t border-[#1e40af]">
            <a id="logoutBtn"
                class="logout flex items-center gap-3 px-4 py-3 rounded-xl text-red-400 hover:bg-red-500/10 hover:text-red-300 font-medium transition-all cursor-pointer">
                <i class="fa-solid fa-right-from-bracket w-5"></i>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- MOBILE OVERLAY -->
    <!-- (Optional: Add valid mobile menu toggle logic if needed, but strict constraints say don't add new logic. We rely on md:flex hidden by default on mobile which might break mobile view. Let's make sidebar hidden on mobile and main width full.) -->

    <!-- MAIN CONTENT -->
    <main class="flex-1 h-full overflow-y-auto w-full relative">

        <!-- HEADER -->
        <header
            class="sticky top-0 bg-white/80 backdrop-blur-md border-b border-gray-200 z-10 px-8 py-5 flex justify-between items-center shadow-sm">
            <div>
                <h1 class="text-2xl font-extrabold text-[#172554] tracking-tight">
                    Welcome Back, <span id="studentName" class="text-blue-600">Student</span> 👋
                </h1>
                <p class="text-sm text-slate-500">Here's what's happening with your courses today.</p>
            </div>

            <div class="flex items-center gap-4">
                <span
                    class="status bg-blue-100 text-blue-700 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm border border-blue-200">
                    <i class="fa-solid fa-circle text-[8px] mr-2"></i> Active Student
                </span>
                <div id="studentInitial"
                    class="h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold border border-blue-200">
                    S
                </div>
            </div>
        </header>

        <!-- CONTENT CONTAINER -->
        <div class="p-8 max-w-7xl mx-auto space-y-8">

            <!-- DASHBOARD SECTION -->
            <section id="dashboard" class="page show fade-in space-y-8">

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div
                        class="card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110">
                        </div>
                        <div class="relative">
                            <p class="text-slate-500 font-medium text-sm mb-1">Enrolled Courses</p>
                            <h2 id="courseCount" class="text-4xl font-extrabold text-[#172554]">0</h2>
                        </div>
                    </div>

                    <div
                        class="card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110">
                        </div>
                        <div class="relative">
                            <p class="text-slate-500 font-medium text-sm mb-1">Pending Tasks</p>
                            <h2 id="pendingCount" class="text-4xl font-extrabold text-[#172554]">0</h2>
                        </div>
                    </div>

                    <div
                        class="card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow relative overflow-hidden group">
                        <div
                            class="absolute top-0 right-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110">
                        </div>
                        <div class="relative">
                            <p class="text-slate-500 font-medium text-sm mb-1">Overall Grade</p>
                            <h2 id="overallGrade" class="text-4xl font-extrabold text-[#172554]">N/A</h2>
                        </div>
                    </div>
                </div>

                <!-- Secondary Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-[#172554] mb-4">Course Completion</h3>
                        <div class="bar w-full h-3 bg-gray-100 rounded-full overflow-hidden mb-3">
                            <div class="fill bg-blue-500 h-full rounded-full transition-all duration-1000"
                                id="completionFill" style="width:0%"></div>
                        </div>
                        <p id="completionText" class="text-sm text-slate-500 font-medium">0% of total curriculum
                            completed</p>
                    </div>

                    <div
                        class="card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-bold text-[#172554]">Study Streak</h3>
                            <p class="text-slate-400 text-sm">Keep it up!</p>
                        </div>
                        <div class="text-right">
                            <h2 id="studyStreak" class="text-3xl font-extrabold text-blue-600">0 Days</h2>
                            <span class="text-xs text-orange-500 font-bold">🔥 On Fire</span>
                        </div>
                    </div>
                </div>

                <!-- Certificate Section -->
                <div id="certificateContainer"
                    class="bg-gradient-to-br from-blue-50 to-white border border-blue-100 p-8 rounded-2xl text-center shadow-sm">
                    <div
                        class="inline-flex items-center justify-center h-16 w-16 bg-blue-100 text-blue-600 rounded-full mb-4 text-2xl">
                        <i class="fa-solid fa-certificate"></i>
                    </div>
                    <h3 id="certHeader" class="text-xl font-bold text-[#172554] mb-2">Completion Certificate</h3>
                    <p id="certMsg" class="text-slate-500 text-sm mb-6 max-w-lg mx-auto">Complete all pending
                        assignments and quizzes to unlock your verified certificate of completion.</p>
                    <div id="certResult" class="mb-4 text-sm font-medium text-blue-600"></div>
                    <button id="downloadCertBtn" disabled
                        class="disabled:opacity-50 disabled:cursor-not-allowed bg-slate-800 hover:bg-[#172554] text-white px-6 py-3 rounded-xl font-semibold shadow-lg shadow-slate-200 transition-all inline-flex items-center gap-2">
                        <i class="fa-solid fa-lock"></i> Certificate Locked
                    </button>
                </div>
            </section>

            <!-- TASKS LIST MOCKUP (Since JS populates it, we just style containers) -->
            <section id="courses" class="page fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-[#172554]">My Courses</h2>
                    <button onclick="openEnrollModal()"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-xl transition-colors shadow-lg shadow-blue-200 text-sm">
                        <i class="fa-solid fa-plus mr-2"></i> Enroll in New Course
                    </button>
                </div>
                <!-- Grid Container populated by JS -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="courseList">
                    <p class="col-span-3 text-center text-slate-400 py-10">Loading your courses...</p>
                </div>
                <!-- Related Resources Section -->
                <div id="resourceSection" class="mt-12 hidden">
                    <div class="border-t border-gray-200 pt-8 mt-8">
                        <h2 class="text-xl font-bold text-[#172554] mb-6">Related Resources</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="resourceList">
                            <!-- Populated via JS -->
                        </div>
                    </div>
                </div>
            </section>

            <section id="assignments" class="page fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-[#172554]">Pending Assignments</h2>
                    <div
                        class="bg-white px-3 py-1 rounded-lg border border-gray-200 text-sm font-medium text-slate-600 shadow-sm">
                        Filter: All
                    </div>
                </div>
                <!-- Assignments injected here. JS likely creates strict HTML strings, 
                     so we might need to rely on generic selectors in CSS or hope structure is simple.
                     Wait, student.js generates HTML strings? Yes. 
                     If student.js generates generic divs/tables, we must ensure CSS covers default elements or updated JS.
                     Constraint: "Do not alter backend logic...". Does changing JS generation string count? 
                     Yes, modifying student.js string templates is part of UI redesign and allowed as long as logic holds.
                     I should Verify student.js.
                     Usually `student.js` looks like `container.innerHTML += ... <div class='card'>`.
                     If I don't update JS, the generated HTML won't have Tailwind classes.
                     So I MUST update `student.js` HTML strings to include Tailwind classes.
                     BUT I first finish structure.
                -->
                <div id="assignmentList" class="space-y-4">
                    <p class="text-slate-400 text-center py-10">Loading assignments...</p>
                </div>
            </section>

            <section id="mentors" class="page fade-in">
                <h2 class="section-title text-2xl font-bold text-[#172554] mb-6">Your Mentors</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="mentorList">
                    <p>Loading mentors...</p>
                </div>
            </section>

            <section id="progress" class="page fade-in">
                <h2 class="section-title text-2xl font-bold text-[#172554] mb-6">Detailed Progress</h2>
                <div id="progressContainer" class="space-y-6">
                    <p>Loading your progress details...</p>
                </div>
            </section>

            <section id="quizzes" class="page fade-in">
                <h2 class="section-title text-2xl font-bold text-[#172554] mb-6">Course Quizzes</h2>
                <div id="quizList" class="space-y-4">
                    <p>Loading quizzes...</p>
                </div>
            </section>

        </div>
    </main>

    <!-- MODALS -->
    <!-- Submit Modal -->
    <div id="submitModal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 relative">
            <span class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 cursor-pointer text-xl"
                onclick="closeSubmitModal()">&times;</span>
            <h3 class="modal-title text-xl font-bold text-gray-900 mb-2">Submit Assignment</h3>
            <p id="modalAssignmentTitle" class="text-blue-600 font-semibold mb-6"></p>

            <form id="assignmentForm" class="submit-form space-y-4">
                <input type="hidden" id="submitAssignmentId" name="assignment_id" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload File (PDF/Zip)</label>
                    <div class="relative">
                        <input type="file" id="assignmentFile" required
                            accept=".pdf,.zip,.doc,.docx,.txt,.ppt,.pptx,.xls,.xlsx" class="block w-full text-sm text-slate-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100 cursor-pointer" />
                    </div>
                </div>
                <button type="submit" id="finalSubmitBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition-colors shadow-lg shadow-blue-200">
                    Submit for Grading
                </button>
            </form>
            <p id="submitMsg"
                class="hidden text-blue-600 text-sm font-bold text-center mt-4 bg-blue-50 py-2 rounded-lg"></p>
        </div>
    </div>

    <!-- View Modal -->
    <div id="viewModal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 relative">
            <span class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 cursor-pointer text-xl"
                onclick="closeViewModal()">&times;</span>
            <h3 class="modal-title text-xl font-bold text-gray-900 mb-2">Submission Details</h3>
            <p id="viewAssignmentTitle" class="text-blue-600 font-semibold mb-4"></p>

            <div class="feedback-box bg-slate-50 border border-slate-100 rounded-xl p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-semibold text-slate-700">Status</span>
                    <span id="viewStatus"
                        class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold uppercase">Submitted</span>
                </div>
                <div id="feedbackContent" class="text-sm text-slate-600 border-t border-slate-200 pt-2 mt-2">
                    <p class="italic text-slate-400">Waiting for trainer feedback...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Task Modal (NEW) -->
    <div id="submitTaskModal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 relative">
            <span class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 cursor-pointer text-xl"
                onclick="closeSubmitTaskModal()">&times;</span>
            <h3 class="modal-title text-xl font-bold text-gray-900 mb-2">Submit Task</h3>
            <p id="modalTaskTitle" class="text-amber-600 font-semibold mb-6"></p>

            <form id="taskForm" class="submit-form space-y-4">
                <input type="hidden" id="submitTaskId" name="task_id" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload File (PDF/Zip/Docs)</label>
                    <div class="relative">
                        <input type="file" id="taskFile" required
                            accept=".pdf,.zip,.doc,.docx,.txt,.ppt,.pptx,.xls,.xlsx" class="block w-full text-sm text-slate-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-amber-50 file:text-amber-700
                            hover:file:bg-amber-100 cursor-pointer" />
                    </div>
                </div>
                <button type="submit" id="finalSubmitTaskBtn"
                    class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-xl transition-colors shadow-lg shadow-amber-200">
                    Submit Task
                </button>
            </form>
            <p id="taskSubmitMsg"
                class="hidden text-amber-600 text-sm font-bold text-center mt-4 bg-amber-50 py-2 rounded-lg"></p>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quizModal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div
            class="modal-content bg-white w-full max-w-3xl rounded-2xl shadow-2xl p-6 relative flex flex-col max-h-[90vh]">
            <span class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 cursor-pointer text-xl"
                onclick="closeQuizModal()">&times;</span>
            <h3 class="modal-title text-xl font-bold text-gray-900 mb-6 border-b pb-4" id="quizModalTitle">Take Quiz
            </h3>

            <div id="quizQuestions" class="quiz-container overflow-y-auto flex-1 p-2 space-y-6">
                <!-- Populated via JS -->
            </div>

            <div class="mt-6 pt-4 border-t border-gray-100">
                <button
                    class="btn-primary w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition-all"
                    onclick="submitQuizAnswers()">
                    Submit Answers
                </button>
            </div>
        </div>
    </div>

    <!-- Enroll Modal -->
    <div id="enrollModal" class="modal fixed inset-0 z-50 items-center justify-center p-4">
        <div class="modal-content bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 relative">
            <span class="close-modal absolute top-4 right-4 text-gray-400 hover:text-gray-600 cursor-pointer text-xl"
                onclick="closeEnrollModal()">&times;</span>
            <h3 class="modal-title text-xl font-bold text-gray-900 mb-2">Enroll in a New Course</h3>
            <p class="text-slate-500 text-sm mb-6">Select a course to start learning.</p>

            <div class="space-y-4">
                <div class="relative">
                    <select id="enrollCourseSelect"
                        class="w-full bg-gray-50 text-gray-800 border border-gray-200 rounded-xl px-4 py-3 outline-none focus:border-blue-500 text-sm appearance-none cursor-pointer hover:border-blue-300 transition-colors">
                        <option value="">Loading available courses...</option>
                    </select>
                    <i
                        class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none text-xs"></i>
                </div>

                <div id="enrollMsg" class="hidden text-center text-sm font-bold p-3 rounded-lg"></div>

                <button onclick="submitEnrollment()"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition-colors shadow-lg shadow-blue-200 mt-2">
                    Confirm Enrollment
                </button>
            </div>
        </div>
    </div>

    <script src="student.js"></script>

</body>

</html>